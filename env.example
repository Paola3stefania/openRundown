# OpenRundown MCP Server Configuration
# Copy this file to .env and fill in your values

# =============================================================================
# Required Configuration
# =============================================================================

# Discord Bot Token (Required)
# Get this from https://discord.com/developers/applications
DISCORD_TOKEN=your_discord_bot_token_here

# GitHub Configuration (Required - configure one or both for rate limit rotation)
# The system automatically rotates between GitHub App and tokens when rate limits are hit

# Personal Access Token(s) - Comma-separated for token rotation
# Get this from https://github.com/settings/tokens
# Multiple tokens: token1,token2,token3 (for automatic rotation)
GITHUB_TOKEN=your_github_token_here

# GitHub App (recommended - highest rate limits)
# See docs/GITHUB_APP_SETUP.md for setup instructions
# Can be used alongside GITHUB_TOKEN for automatic fallback
GITHUB_APP_ID=your_app_id
GITHUB_APP_INSTALLATION_ID=your_installation_id
GITHUB_APP_PRIVATE_KEY_PATH=/path/to/your-app.pem

# GitHub Repository Configuration (Required)
# Can be in Linear format (owner/repo) or full URL
# Examples:
#   - better-auth/better-auth (Linear format, preferred)
#   - https://github.com/better-auth/better-auth
GITHUB_REPO_URL=your_org_or_username/your_repository_name

# Local Repository Path (Optional)
# If set, code indexing will first try to read from local filesystem before falling back to GitHub API
# This is useful when running the MCP server from within the repository (e.g., Better Auth repo)
# Can be an absolute path or relative path (relative to where the MCP server runs)
# Examples:
#   - Absolute: /Users/user/Coding/betterAuth/better-auth
#   - Relative: ../better-auth (if repo is in parent directory)
#   - Relative: ./better-auth (if repo is in same directory)
LOCAL_REPO_PATH=

# =============================================================================
# Optional Discord Configuration
# =============================================================================

# Discord Server ID (Optional)
# The default Discord server to use
DISCORD_SERVER_ID=

# Discord Default Channel ID (Optional)
# The default channel ID to use for operations
DISCORD_DEFAULT_CHANNEL_ID=

# Discord Channel Names (Optional)
# Custom channel names (used for organization)
DISCORD_CHANNEL_DEVELOPMENT=development
DISCORD_CHANNEL_GENERAL=general
DISCORD_CHANNEL_CHAT=chat

# =============================================================================
# File Paths Configuration (Optional)
# =============================================================================

# Results directory (default: results)
RESULTS_DIR=results

# Cache directory (default: cache)
CACHE_DIR=cache

# GitHub issues cache file name (default: github-issues-cache.json)
ISSUES_CACHE_FILE=github-issues-cache.json

# =============================================================================
# Storage Configuration (Optional)
# =============================================================================

# Database URL (Optional)
# If set, uses PostgreSQL database for storage
# If not set, uses JSON files for storage (try-it-out mode)
#
# LOCAL DEVELOPMENT (macOS):
# DATABASE_URL=postgresql://$(whoami)@localhost:5432/openrundown
# Or with hardcoded username:
# DATABASE_URL=postgresql://your_username@localhost:5432/openrundown
#
# VERCEL PRODUCTION (set in Vercel Dashboard → Environment Variables):
# DATABASE_URL=postgres://...@...vercel-storage.com/...
#
# OTHER OPTIONS:
# - Neon: postgresql://user:pass@ep-xxx.region.neon.tech/dbname?sslmode=require
# - Supabase: postgresql://postgres:pass@db.xxx.supabase.co:5432/postgres
DATABASE_URL=

# Default fetch limits when database is not configured (try-it-out mode)
# These limits apply automatically when DATABASE_URL is not set
# Set to limit the number of items fetched to avoid overwhelming the system
# Default: 100 issues, 100 messages
DEFAULT_FETCH_LIMIT_ISSUES=100
DEFAULT_FETCH_LIMIT_MESSAGES=100

# =============================================================================
# Classification Configuration (Optional)
# =============================================================================

# Use semantic classification with OpenAI (default: true if OPENAI_API_KEY is set)
# Set to "false" to disable semantic classification
USE_SEMANTIC_CLASSIFICATION=true

# OpenAI API Key (Optional, but required for semantic classification)
# Get this from https://platform.openai.com/api-keys
OPENAI_API_KEY=your_openai_api_key_here

# =============================================================================
# PM Tool Integration Configuration
# =============================================================================
# PM Integration is automatically enabled when PM_TOOL_TYPE is set

# Documentation URLs (Required for export)
# Comma-separated list of URLs or local file paths to product documentation
# URLs ending with /docs will be automatically crawled
# Examples:
#   - https://docs.example.com/docs (will crawl all docs pages)
#   - https://docs.example.com/api
#   - ./docs/readme.md (local file)
DOCUMENTATION_URLS=https://docs.example.com/docs

# Feature Extraction Configuration
FEATURE_EXTRACTION_ENABLED=true
FEATURE_AUTO_UPDATE=false

# PM Tool Type (linear, jira, github, custom)
PM_TOOL_TYPE=linear

# PM Tool API Key (Required)
# For Linear: Personal API Key from https://linear.app/settings/api (REQUIRED for Linear)
#   - Go to https://linear.app/settings/api
#   - Click "Create API Key"
#   - Copy the key and paste it here
# For Jira: API Token from https://id.atlassian.com/manage-profile/security/api-tokens
PM_TOOL_API_KEY=your_pm_tool_api_key_here

# PM Tool API URL (Required for Jira, optional for Linear)
# For Jira: https://your-domain.atlassian.net
# For Linear: https://api.linear.app/graphql (default)
PM_TOOL_API_URL=

# PM Tool Team ID (Optional for Linear - auto-created if not set)
# For Linear: Team ID or Team Key (e.g., "ENG", "PROD")
#   - If not set, "OpenRundown" team will be automatically created on first export
#   - Projects are automatically created from features extracted from documentation (no PM_TOOL_PROJECT_ID needed)
#   - Use list_linear_teams MCP tool to find your team ID
#   - Or: Linear Settings → Teams → Click team → Copy ID from URL or settings
PM_TOOL_TEAM_ID=

# For Jira: Project Key (e.g., "PROJ") - Only needed for Jira, not Linear
# PM_TOOL_PROJECT_ID=

# PM Tool Workspace ID (Optional)
PM_TOOL_WORKSPACE_ID=

# PM Tool Board ID (Optional)
PM_TOOL_BOARD_ID=

# =============================================================================
# PR-based Sync Configuration (Optional)
# =============================================================================

# Organization Members CSV File (Recommended for PR-based sync)
# Path to CSV file exported from your organization with team members
# The CSV should have columns: Name, Email, Role, Teams, Active, GitHub Username
# If GitHub Username column exists, mappings will be auto-built by matching emails to Linear users
# Default: members.csv in project root
# Place members.csv in project root (it's in .gitignore for privacy)
# MEMBERS_CSV_PATH=members.csv

# Organization Engineers List (Alternative to CSV - not needed if using CSV with GitHub column)
# List of organization engineer GitHub usernames
# Only PRs from these engineers will trigger Linear issue assignment
# Format: JSON array: ["username1", "username2"] or comma-separated: "username1,username2"
# Example: ["engineer1", "engineer2"] or "engineer1,engineer2"
# ORGANIZATION_ENGINEERS=["engineer1","engineer2"]

# User Mappings (Optional - auto-built from CSV if available)
# Maps organization engineer GitHub usernames to Linear user IDs
# Used by PR-based sync to automatically assign Linear issues when PRs are opened by organization engineers
# Format: JSON array of { "githubUsername": "github_username", "linearUserId": "linear-user-id" }
# Example: [{"githubUsername": "engineer1", "linearUserId": "linear-user-id-123"}]
# Note: If MEMBERS_CSV_PATH is set and CSV has GitHub Username column, mappings are auto-built automatically
# To find Linear user IDs manually, use the listUsers() method in LinearIntegration or query Linear API
# USER_MAPPINGS=[{"githubUsername":"engineer1","linearUserId":"linear-user-id"}]

# Default Assignee ID for PR-based Sync (Optional)
# If no user mapping is found for a PR author (but they are an organization engineer), assign to this user
# DEFAULT_ASSIGNEE_ID=linear-user-id-123

# Default Linear User ID for PR-based Sync (Optional)
# If no user mapping is found for a PR author, this user will be assigned instead
# Only used if USER_MAPPINGS is also configured
# DEFAULT_ASSIGNEE_ID=linear-user-id-123

# =============================================================================
# Vercel Deployment Configuration
# =============================================================================

# Cron Secret (Required for Vercel Cron)
# Generate with: openssl rand -base64 32
# Vercel automatically sends this as Authorization header for cron jobs
CRON_SECRET=your_cron_secret_here

# OpenRundown API Key (Required for HTTP API calls)
# Generate with: openssl rand -base64 32
# Used by Cursor and other HTTP clients to call /api/mcp/* endpoints
OPENRUNDOWN_API_KEY=your_api_key_here
